<!DOCTYPE html>
<html>
<head>
  <title>OMO Ride Simulation</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    }
    
    #map {
      height: 100vh;
      width: 100%;
    }
    
    .controls {
      position: absolute;
      top: 20px;
      left: 20px;
      background: white;
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      z-index: 1000;
    }
    
    .controls h3 {
      margin: 0 0 10px 0;
      color: #333;
      font-size: 16px;
    }
    
    .controls p {
      margin: 5px 0;
      color: #666;
      font-size: 14px;
    }
    
    .omo-blue {
      color: #9EDAE5;
      font-weight: bold;
    }
  </style>
</head>
<body>

<div class="controls">
  <h3>üöó OMO Ride Simulation</h3>
  <p>Route: Kochi ‚Üí Destination</p>
  <p>Path Color: <span class="omo-blue">#9EDAE5</span> (OMO Blue)</p>
  <p>Status: <span id="status">Calculating route...</span></p>
</div>

<div id="map"></div>

<script src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY&callback=initMap"></script>

<script>
let map;
let directionsService;
let directionsRenderer;
let carMarker;
let routePath = [];
let step = 0;
let isAnimating = false;

function initMap() {
  const start = { lat: 10.0159, lng: 76.3419 };   // Kochi example
  const end = { lat: 10.0000, lng: 76.3500 };

  map = new google.maps.Map(document.getElementById("map"), {
    zoom: 14,
    center: start,
    styles: [
      {
        featureType: "all",
        elementType: "geometry.fill",
        stylers: [{ color: "#f5f5f5" }]
      },
      {
        featureType: "water",
        elementType: "geometry",
        stylers: [{ color: "#9EDAE5" }]
      }
    ]
  });

  directionsService = new google.maps.DirectionsService();
  directionsRenderer = new google.maps.DirectionsRenderer({
    suppressMarkers: false,
    polylineOptions: {
      strokeColor: "#9EDAE5",  // OMO Blue
      strokeWeight: 6,
    }
  });

  directionsRenderer.setMap(map);

  // Add custom markers
  const startMarker = new google.maps.Marker({
    position: start,
    map: map,
    title: "Start Location",
    icon: {
      path: google.maps.SymbolPath.CIRCLE,
      scale: 8,
      fillColor: "#9EDAE5",
      fillOpacity: 1,
      strokeColor: "#fff",
      strokeWeight: 2
    }
  });

  const endMarker = new google.maps.Marker({
    position: end,
    map: map,
    title: "Destination",
    icon: {
      path: google.maps.SymbolPath.FLAG,
      scale: 8,
      fillColor: "#9EDAE5",
      fillOpacity: 1,
      strokeColor: "#fff",
      strokeWeight: 1
    }
  });

  directionsService.route(
    {
      origin: start,
      destination: end,
      travelMode: google.maps.TravelMode.DRIVING,
    },
    (result, status) => {
      if (status === "OK") {
        directionsRenderer.setDirections(result);
        document.getElementById("status").textContent = "Route calculated! Starting animation...";

        // Extract route points
        const route = result.routes[0].overview_path;
        routePath = route;

        // Start animation after a short delay
        setTimeout(() => {
          startCarAnimation();
        }, 1000);
      } else {
        document.getElementById("status").textContent = "Error: " + status;
        console.error("Directions request failed due to " + status);
      }
    }
  );
}

function startCarAnimation() {
  if (isAnimating) return;
  isAnimating = true;
  
  carMarker = new google.maps.Marker({
    position: routePath[0],
    map: map,
    icon: {
      url: "https://maps.google.com/mapfiles/kml/shapes/cabs.png",
      scaledSize: new google.maps.Size(40, 40),
    }
  });

  document.getElementById("status").textContent = "üöó Car is moving...";
  moveCar();
}

function moveCar() {
  if (step < routePath.length) {
    carMarker.setPosition(routePath[step]);
    map.panTo(routePath[step]);
    
    // Update progress
    const progress = Math.round((step / routePath.length) * 100);
    document.getElementById("status").textContent = `üöó Progress: ${progress}%`;
    
    step++;
    setTimeout(moveCar, 100); // speed control
  } else {
    isAnimating = false;
    document.getElementById("status").textContent = "üéâ Destination Reached!";
    
    // Show completion message
    setTimeout(() => {
      alert("üéâ Welcome to your destination! Thank you for riding with OMO! üöó");
    }, 500);
  }
}

// Error handling for Google Maps loading
window.gm_authFailure = function() {
  document.getElementById("status").textContent = "‚ùå Google Maps API key required";
  document.getElementById("status").style.color = "red";
};

// Handle window load
window.onload = function() {
  if (!window.google) {
    document.getElementById("status").textContent = "‚ùå Failed to load Google Maps";
    document.getElementById("status").style.color = "red";
  }
};
</script>

</body>
</html>
